---
title: 'CA3003: Esaminare il codice per verificare la presenza di vulnerabilità di tipo file path injection'
ms.date: 04/03/2019
ms.topic: reference
author: dotpaul
ms.author: paulming
manager: jillfra
dev_langs:
- CSharp
- VB
ms.workload:
- multiple
ms.openlocfilehash: f685dfecbcf32fa9e8346a84c94e1039f2619f3a
ms.sourcegitcommit: 6cfffa72af599a9d667249caaaa411bb28ea69fd
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 09/02/2020
ms.locfileid: "88707205"
---
# <a name="ca3003-review-code-for-file-path-injection-vulnerabilities"></a>CA3003: Esaminare il codice per verificare la presenza di vulnerabilità di tipo file path injection

|Elemento|valore|
|-|-|
|CheckId|Ca3003|
|Category|Microsoft.Security|
|Modifica|Senza interruzioni|

## <a name="cause"></a>Causa

Un input di richiesta HTTP potenzialmente non attendibile raggiunge il percorso di un'operazione su file.

Per impostazione predefinita, questa regola analizza l'intera codebase, ma può essere [configurata](#configurability).

## <a name="rule-description"></a>Descrizione della regola

Quando si utilizza un input non attendibile da richieste Web, tenere presente l'utilizzo dell'input controllato dall'utente quando si specificano i percorsi dei file. Un utente malintenzionato potrebbe essere in grado di leggere un file imprevisto, causando la divulgazione di dati sensibili. In alternativa, un utente malintenzionato potrebbe essere in grado di scrivere in un file non intenzionale, causando la modifica non autorizzata dei dati sensibili o compromettendo la sicurezza del server. Una tecnica di attacco comune è l' [attraversamento del percorso](https://www.owasp.org/index.php/Path_Traversal) per accedere ai file all'esterno della directory desiderata.

Questa regola tenta di trovare l'input da richieste HTTP che raggiungono un percorso in un'operazione su file.

> [!NOTE]
> Questa regola non è in grado di rilevare i dati tra gli assembly. Se, ad esempio, un assembly legge l'input della richiesta HTTP e lo passa a un altro assembly che scrive in un file, questa regola non genera un avviso.

> [!NOTE]
> Esiste un limite configurabile per il livello di profondità con cui questa regola analizzerà il flusso di dati tra le chiamate al metodo. Per informazioni su come configurare il limite in un file EditorConfig, vedere la pagina relativa alla [configurazione dell'analizzatore](https://github.com/dotnet/roslyn-analyzers/blob/master/docs/Analyzer%20Configuration.md#dataflow-analysis) .

## <a name="how-to-fix-violations"></a>Come correggere le violazioni

- Se possibile, limitare i percorsi di file in base all'input dell'utente a un elenco sicuro noto in modo esplicito.  Ad esempio, se l'applicazione deve solo accedere a "red.txt", "green.txt" o "blue.txt", consentire solo questi valori.
- Verificare la presenza di nomi file non attendibili e verificare che il nome sia ben formato.
- Usare nomi di percorso completi quando si specificano i percorsi.
- Evitare costrutti potenzialmente pericolosi, ad esempio le variabili di ambiente Path.
- Accettare solo nomi di file lunghi e convalidare il nome lungo se l'utente invia nomi brevi.
- Limitare l'input dell'utente finale a caratteri validi.
- Rifiutare i nomi in cui viene superata MAX_PATH lunghezza.
- Gestire i nomi di file letteralmente, senza interpretare.
- Determinare se il nome file rappresenta un file o un dispositivo.

## <a name="when-to-suppress-warnings"></a>Quando escludere gli avvisi

Se l'input è stato convalidato come descritto nella sezione precedente, è possibile evitare di visualizzare questo avviso.

## <a name="configurability"></a>Configurabilità

Questa regola include le opzioni configurabili seguenti.

### <a name="excluded-symbol-names"></a>Nomi di simboli esclusi

È possibile configurare le parti della codebase da escludere dall'analisi. Ad esempio, per specificare che la regola non deve essere eseguita in alcun codice all'interno di tipi denominati `MyType` , aggiungere la coppia chiave-valore seguente a un file con estensione EditorConfig nel progetto:

```ini
dotnet_code_quality.CA3003.excluded_symbol_names = MyType
```

Formati dei nomi di simboli consentiti nel valore dell'opzione (separati da' |'):
- Solo nome simbolo (include tutti i simboli con il nome, indipendentemente dal tipo o dallo spazio dei nomi che lo contiene)
- Nomi completi nel [formato ID documentazione](https://github.com/dotnet/csharplang/blob/master/spec/documentation-comments.md#id-string-format)del simbolo. Ogni nome di simbolo richiede un prefisso di tipo simbolo, ad esempio il prefisso "M:" per i metodi, il prefisso "T:" per i tipi, il prefisso "N:" per gli spazi dei nomi e così via.
- `.ctor` per costruttori e `.cctor` per costruttori statici

Esempi:

| Valore dell'opzione | Riepilogo |
| --- | --- |
|`dotnet_code_quality.CA3003.excluded_symbol_names = MyType` | Corrisponde a tutti i simboli denominati ' MyType ' nella compilazione
|`dotnet_code_quality.CA3003.excluded_symbol_names = MyType1|MyType2` | Corrisponde a tutti i simboli denominati ' MyType1' o ' MyType2' nella compilazione
|`dotnet_code_quality.CA3003.excluded_symbol_names = M:NS.MyType.MyMethod(ParamType)` | Corrisponde al metodo specifico ' MyMethod ' con la firma completa specificata
|`dotnet_code_quality.CA3003.excluded_symbol_names = M:NS1.MyType1.MyMethod1(ParamType)|M:NS2.MyType2.MyMethod2(ParamType)` | Corrisponde ai metodi specifici ' MyMethod1' è MyMethod2' con la rispettiva firma completa

È possibile configurare tutte queste opzioni solo per questa regola, per tutte le regole o per tutte le regole in questa categoria (sicurezza). Per altre informazioni, vedere [configurare gli analizzatori di qualità del codice .NET](configure-fxcop-analyzers.md).

## <a name="pseudo-code-examples"></a>Esempi di pseudo-codice

### <a name="violation"></a>Violazione

```csharp
using System;
using System.IO;

public partial class WebForm : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        string userInput = Request.Params["UserInput"];
        // Assume the following directory structure:
        //   wwwroot\currentWebDirectory\user1.txt
        //   wwwroot\currentWebDirectory\user2.txt
        //   wwwroot\secret\allsecrets.txt
        // There is nothing wrong if the user inputs:
        //   user1.txt
        // However, if the user input is:
        //   ..\secret\allsecrets.txt
        // Then an attacker can now see all the secrets.

        // Avoid this:
        using (File.Open(userInput, FileMode.Open))
        {
            // Read a file with the name supplied by user
            // Input through request's query string and display
            // The content to the webpage.
        }
    }
}
```

```vb
Imports System
Imports System.IO

Partial Public Class WebForm
    Inherits System.Web.UI.Page

    Protected Sub Page_Load(sender As Object, e As EventArgs)
        Dim userInput As String = Me.Request.Params("UserInput")
        ' Assume the following directory structure:
        '   wwwroot\currentWebDirectory\user1.txt
        '   wwwroot\currentWebDirectory\user2.txt
        '   wwwroot\secret\allsecrets.txt
        ' There is nothing wrong if the user inputs:
        '   user1.txt
        ' However, if the user input is:
        '   ..\secret\allsecrets.txt
        ' Then an attacker can now see all the secrets.

        ' Avoid this:
        Using File.Open(userInput, FileMode.Open)
            ' Read a file with the name supplied by user
            ' Input through request's query string and display
            ' The content to the webpage.
        End Using
    End Sub
End Class
```
