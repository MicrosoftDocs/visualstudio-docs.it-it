---
title: 'CA2100: Controllare la vulnerabilità della sicurezza nelle query SQL'
ms.date: 11/04/2016
ms.topic: reference
f1_keywords:
- Review SQL queries for security vulnerabilities
- ReviewSqlQueriesForSecurityVulnerabilities
- CA2100
helpviewer_keywords:
- CA2100
- ReviewSqlQueriesForSecurityVulnerabilities
ms.assetid: 79670604-c02a-448d-9c0e-7ea0120bc5fe
author: mikejo5000
ms.author: mikejo
manager: jillfra
dev_langs:
- CSharp
- VB
ms.workload:
- multiple
ms.openlocfilehash: e7574fa1826e5b9add96f0851be48429551506dd
ms.sourcegitcommit: a18c7e9b367c2f92f6e54c3eaef442775d457667
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 09/15/2020
ms.locfileid: "90098737"
---
# <a name="ca2100-review-sql-queries-for-security-vulnerabilities"></a>CA2100: Controllare la vulnerabilità della sicurezza nelle query SQL

|Elemento|valore|
|-|-|
|ID regola|CA2100|
|Category|Microsoft.Security|
|Modifica|Senza interruzioni|

## <a name="cause"></a>Causa

Un metodo imposta la <xref:System.Data.IDbCommand.CommandText%2A?displayProperty=fullName> proprietà utilizzando una stringa compilata da un argomento stringa nel metodo.

Per impostazione predefinita, questa regola analizza l'intera codebase, ma può essere [configurata](#configurability).

## <a name="rule-description"></a>Descrizione della regola

Questa regola presuppone che qualsiasi stringa, il cui valore non può essere determinato in fase di compilazione, possa contenere l'input dell'utente. Una stringa di comando SQL compilata da un input dell'utente è vulnerabile agli attacchi intrusivi nel codice SQL, In un attacco SQL injection, un utente malintenzionato fornisce un input che modifica la progettazione di una query in un tentativo di danneggiare o ottenere accesso non autorizzato al database sottostante. Le tecniche tipiche includono l'inserimento di una virgoletta singola o di un apostrofo, ovvero il delimitatore di stringa letterale SQL; due trattini, che indica un commento SQL; e un punto e virgola, che indica che segue un nuovo comando. Se l'input dell'utente deve far parte della query, usare uno dei seguenti elementi, elencati in ordine di efficacia, per ridurre il rischio di attacco.

- Utilizza una stored procedure.

- Usare una stringa di comando con parametri.

- Convalidare l'input dell'utente per il tipo e il contenuto prima di compilare la stringa di comando.

I tipi .NET seguenti implementano la <xref:System.Data.IDbCommand.CommandText%2A> proprietà o forniscono costruttori che impostano la proprietà tramite un argomento di stringa.

- <xref:System.Data.Odbc.OdbcCommand?displayProperty=fullName> e <xref:System.Data.Odbc.OdbcDataAdapter?displayProperty=fullName>

- <xref:System.Data.OleDb.OleDbCommand?displayProperty=fullName> e <xref:System.Data.OleDb.OleDbDataAdapter?displayProperty=fullName>

- <xref:System.Data.OracleClient.OracleCommand?displayProperty=fullName> e <xref:System.Data.OracleClient.OracleDataAdapter?displayProperty=fullName>

- <xref:System.Data.SqlClient.SqlCommand?displayProperty=fullName> e <xref:System.Data.SqlClient.SqlDataAdapter?displayProperty=fullName>

In alcuni casi, questa regola potrebbe non determinare il valore di una stringa in fase di compilazione, anche se è possibile. In questi casi, questa regola produce falsi positivi quando si usano tali stringhe come comandi SQL. Di seguito è riportato un esempio di una stringa di questo tipo.

```csharp
int x = 10;
string query = "SELECT TOP " + x.ToString() + " FROM Table";
```

Lo stesso vale quando si usa in `ToString()` modo implicito.

```csharp
int x = 10;
string query = String.Format("SELECT TOP {0} FROM Table", x);
```

## <a name="how-to-fix-violations"></a>Come correggere le violazioni

Per correggere una violazione di questa regola, utilizzare una query con parametri.

## <a name="when-to-suppress-warnings"></a>Quando escludere gli avvisi

È possibile eliminare un avviso da questa regola se il testo del comando non contiene alcun input dell'utente.

## <a name="configurability"></a>Configurabilità

Questa regola include le opzioni configurabili seguenti.

### <a name="excluded-symbol-names"></a>Nomi di simboli esclusi

È possibile configurare le parti della codebase da escludere dall'analisi. Ad esempio, per specificare che la regola non deve essere eseguita in alcun codice all'interno di tipi denominati `MyType` , aggiungere la coppia chiave-valore seguente a un file con estensione EditorConfig nel progetto:

```ini
dotnet_code_quality.CA2100.excluded_symbol_names = MyType
```

Formati dei nomi di simboli consentiti nel valore dell'opzione (separati da' |'):
- Solo nome simbolo (include tutti i simboli con il nome, indipendentemente dal tipo o dallo spazio dei nomi che lo contiene)
- Nomi completi nel [formato ID documentazione](https://github.com/dotnet/csharplang/blob/master/spec/documentation-comments.md#id-string-format)del simbolo. Ogni nome di simbolo richiede un prefisso di tipo simbolo, ad esempio il prefisso "M:" per i metodi, il prefisso "T:" per i tipi, il prefisso "N:" per gli spazi dei nomi e così via.
- `.ctor` per costruttori e `.cctor` per costruttori statici

Esempi:

| Valore dell'opzione | Riepilogo |
| --- | --- |
|`dotnet_code_quality.CA2100.excluded_symbol_names = MyType` | Corrisponde a tutti i simboli denominati ' MyType ' nella compilazione
|`dotnet_code_quality.CA2100.excluded_symbol_names = MyType1|MyType2` | Corrisponde a tutti i simboli denominati ' MyType1' o ' MyType2' nella compilazione
|`dotnet_code_quality.CA2100.excluded_symbol_names = M:NS.MyType.MyMethod(ParamType)` | Corrisponde al metodo specifico ' MyMethod ' con la firma completa specificata
|`dotnet_code_quality.CA2100.excluded_symbol_names = M:NS1.MyType1.MyMethod1(ParamType)|M:NS2.MyType2.MyMethod2(ParamType)` | Corrisponde ai metodi specifici ' MyMethod1' è MyMethod2' con la rispettiva firma completa

È possibile configurare tutte queste opzioni solo per questa regola, per tutte le regole o per tutte le regole in questa categoria (sicurezza). Per altre informazioni, vedere [configurare gli analizzatori di qualità del codice .NET](configure-fxcop-analyzers.md).

## <a name="example"></a>Esempio

Nell'esempio seguente viene illustrato un metodo, `UnsafeQuery` , che viola la regola e un metodo, `SaferQuery` , che soddisfa la regola utilizzando una stringa di comando con parametri.

[!code-vb[FxCop.Security.ReviewSqlQueries#1](../code-quality/codesnippet/VisualBasic/ca2100-review-sql-queries-for-security-vulnerabilities_1.vb)]
[!code-csharp[FxCop.Security.ReviewSqlQueries#1](../code-quality/codesnippet/CSharp/ca2100-review-sql-queries-for-security-vulnerabilities_1.cs)]

## <a name="see-also"></a>Vedere anche

- [Panoramica della sicurezza](/dotnet/framework/data/adonet/security-overview)
