---
title: 'CA2100: Controllare la vulnerabilità della sicurezza nelle query SQL'
ms.date: 11/04/2016
ms.topic: reference
f1_keywords:
- Review SQL queries for security vulnerabilities
- ReviewSqlQueriesForSecurityVulnerabilities
- CA2100
helpviewer_keywords:
- CA2100
- ReviewSqlQueriesForSecurityVulnerabilities
ms.assetid: 79670604-c02a-448d-9c0e-7ea0120bc5fe
author: jillre
ms.author: jillfra
manager: jillfra
dev_langs:
- CPP
- CSharp
- VB
ms.workload:
- multiple
ms.openlocfilehash: e4ab521ca95396fb07203ae125cbd55a91e7015f
ms.sourcegitcommit: c222052906362bf1a3762ec4d4623170e4e06702
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 12/04/2019
ms.locfileid: "74809747"
---
# <a name="ca2100-review-sql-queries-for-security-vulnerabilities"></a>CA2100: Controllare la vulnerabilità della sicurezza nelle query SQL

|||
|-|-|
|TypeName|ReviewSqlQueriesForSecurityVulnerabilities|
|CheckId|CA2100|
|Category|Microsoft.Security|
|Modifica|Senza interruzioni|

## <a name="cause"></a>Causa

Un metodo imposta la proprietà <xref:System.Data.IDbCommand.CommandText%2A?displayProperty=fullName> usando una stringa compilata da un argomento stringa nel metodo.

Per impostazione predefinita, questa regola analizza l'intera codebase, ma può essere [configurata](#configurability).

## <a name="rule-description"></a>Descrizione della regola

La regola presuppone che l'argomento stringa contenga l'input dell'utente. Una stringa di comando SQL compilata da un input dell'utente è vulnerabile agli attacchi intrusivi nel codice SQL, In un attacco SQL injection, un utente malintenzionato fornisce un input che modifica la progettazione di una query in un tentativo di danneggiare o ottenere accesso non autorizzato al database sottostante. Le tecniche tipiche includono l'inserimento di una virgoletta singola o di un apostrofo, ovvero il delimitatore di stringa letterale SQL; due trattini, che indica un commento SQL; e un punto e virgola, che indica che segue un nuovo comando. Se l'input dell'utente deve far parte della query, usare uno dei seguenti elementi, elencati in ordine di efficacia, per ridurre il rischio di attacco.

- Utilizza una stored procedure.

- Usare una stringa di comando con parametri.

- Convalidare l'input dell'utente per il tipo e il contenuto prima di compilare la stringa di comando.

I tipi .NET seguenti implementano la proprietà <xref:System.Data.IDbCommand.CommandText%2A> o forniscono costruttori che impostano la proprietà tramite un argomento di stringa.

- <xref:System.Data.Odbc.OdbcCommand?displayProperty=fullName> e <xref:System.Data.Odbc.OdbcDataAdapter?displayProperty=fullName>

- <xref:System.Data.OleDb.OleDbCommand?displayProperty=fullName> e <xref:System.Data.OleDb.OleDbDataAdapter?displayProperty=fullName>

- <xref:System.Data.OracleClient.OracleCommand?displayProperty=fullName> e <xref:System.Data.OracleClient.OracleDataAdapter?displayProperty=fullName>

- <xref:System.Data.SqlClient.SqlCommand?displayProperty=fullName> e <xref:System.Data.SqlClient.SqlDataAdapter?displayProperty=fullName>

Si noti che questa regola viene violata quando il metodo ToString di un tipo viene usato in modo esplicito o implicito per costruire la stringa di query. Di seguito è riportato un esempio.

```csharp
int x = 10;
string query = "SELECT TOP " + x.ToString() + " FROM Table";
```

La regola viene violata perché un utente malintenzionato può eseguire l'override del metodo ToString ().

La regola viene violata anche quando si usa il metodo ToString in modo implicito.

```csharp
int x = 10;
string query = String.Format("SELECT TOP {0} FROM Table", x);
```

## <a name="how-to-fix-violations"></a>Come correggere le violazioni

Per correggere una violazione di questa regola, utilizzare una query con parametri.

## <a name="when-to-suppress-warnings"></a>Quando escludere gli avvisi

È possibile eliminare un avviso da questa regola se il testo del comando non contiene alcun input dell'utente.

## <a name="configurability"></a>Configurabilità

Se si esegue questa regola da [analizzatori FxCop](install-fxcop-analyzers.md) (e non con analisi legacy), è possibile configurare l'analisi per questa regola.

### <a name="excluded-symbol-names"></a>Nomi di simboli esclusi

È possibile configurare le parti della codebase da escludere dall'analisi. Ad esempio, per specificare che la regola non deve essere eseguita in alcun codice all'interno di tipi denominati `MyType`, aggiungere la coppia chiave-valore seguente a un file con estensione EditorConfig nel progetto:

```ini
dotnet_code_quality.CA2100.excluded_symbol_names = MyType
```

Formati dei nomi di simboli consentiti nel valore dell'opzione (separati da' |'):
  - Solo nome simbolo (include tutti i simboli con il nome, indipendentemente dal tipo o dallo spazio dei nomi che lo contiene)
  - Nomi completi nel [formato ID documentazione](https://github.com/dotnet/csharplang/blob/master/spec/documentation-comments.md#id-string-format)del simbolo. Ogni nome di simbolo richiede un prefisso di tipo simbolo, ad esempio il prefisso "M:" per i metodi, il prefisso "T:" per i tipi, il prefisso "N:" per gli spazi dei nomi e così via.
  - `.ctor` per costruttori e `.cctor` per costruttori statici

Esempi:

| Valore dell'opzione | Riepilogo |
| --- | --- |
|`dotnet_code_quality.CA2100.excluded_symbol_names = MyType` | Corrisponde a tutti i simboli denominati ' MyType ' nella compilazione
|`dotnet_code_quality.CA2100.excluded_symbol_names = MyType1|MyType2` | Corrisponde a tutti i simboli denominati ' MyType1' o ' MyType2' nella compilazione
|`dotnet_code_quality.CA2100.excluded_symbol_names = M:NS.MyType.MyMethod(ParamType)` | Corrisponde al metodo specifico ' MyMethod ' con la firma completa specificata
|`dotnet_code_quality.CA2100.excluded_symbol_names = M:NS1.MyType1.MyMethod1(ParamType)|M:NS2.MyType2.MyMethod2(ParamType)` | Corrisponde ai metodi specifici ' MyMethod1' è MyMethod2' con la rispettiva firma completa

È possibile configurare tutte queste opzioni solo per questa regola, per tutte le regole o per tutte le regole in questa categoria (sicurezza). Per altre informazioni, vedere [configurare gli analizzatori FxCop](configure-fxcop-analyzers.md).

## <a name="example"></a>Esempio

Nell'esempio seguente viene illustrato un metodo, `UnsafeQuery`, che viola la regola e un metodo, `SaferQuery`, che soddisfa la regola utilizzando una stringa di comando con parametri.

[!code-vb[FxCop.Security.ReviewSqlQueries#1](../code-quality/codesnippet/VisualBasic/ca2100-review-sql-queries-for-security-vulnerabilities_1.vb)]
[!code-csharp[FxCop.Security.ReviewSqlQueries#1](../code-quality/codesnippet/CSharp/ca2100-review-sql-queries-for-security-vulnerabilities_1.cs)]
[!code-cpp[FxCop.Security.ReviewSqlQueries#1](../code-quality/codesnippet/CPP/ca2100-review-sql-queries-for-security-vulnerabilities_1.cpp)]

## <a name="see-also"></a>Vedere anche

- [Panoramica della sicurezza](/dotnet/framework/data/adonet/security-overview)
